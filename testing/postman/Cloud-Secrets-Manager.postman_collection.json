{
	"info": {
		"_postman_id": "cloud-secrets-manager-collection",
		"name": "Cloud Secrets Manager API",
		"description": "Complete API collection for Cloud Secrets Manager with Google Identity Platform - Full Test Suite",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Setup",
			"item": [
				{
					"name": "Create Admin User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has required fields\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('uid');",
									"    pm.expect(response).to.have.property('email');",
									"    pm.expect(response).to.have.property('roles');",
									"    pm.expect(response.email).to.equal('admin@example.com');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"admin_uid\", response.uid);",
									"    pm.environment.set(\"admin_email\", response.email);",
									"    console.log(\"‚úÖ Admin user created:\", response.email, \"UID:\", response.uid);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@example.com\",\n    \"password\": \"Admin123!@#\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/setup/create-admin",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"setup",
								"create-admin"
							]
						},
						"description": "Creates the first admin user. ‚ö†Ô∏è Disable setup endpoint after initial setup!"
					},
					"response": []
				},
				{
					"name": "Create Test User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User created successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('uid');",
									"    pm.expect(response).to.have.property('email');",
									"    pm.expect(response.email).to.equal('user@example.com');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"test_user_uid\", response.uid);",
									"    pm.environment.set(\"test_user_email\", response.email);",
									"    console.log(\"‚úÖ Test user created:\", response.email);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"password\": \"User123!@#\",\n    \"roles\": [\"USER\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/setup/create-user",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"setup",
								"create-user"
							]
						},
						"description": "Creates a test user with specified roles"
					},
					"response": []
				},
				{
					"name": "Assign Custom Claims (Firebase)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get('claims_email')) {",
									"    pm.environment.set('claims_email', pm.environment.get('admin_email') || 'admin@example.com');",
									"    console.warn('‚ÑπÔ∏è claims_email not set. Defaulting to admin_email.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains assignment metadata\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('email');",
									"    pm.expect(response).to.have.property('roles');",
									"    pm.expect(response).to.have.property('permissions');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    console.log(`‚úÖ Custom claims assigned to ${response.email}`);",
									"    console.log('Roles:', response.roles);",
									"    console.log('Permissions:', response.permissions);",
									"    console.warn('‚ÑπÔ∏è Ask the user to sign out/in to refresh their token.');",
									"} else {",
									"    console.error('‚ùå Failed to assign claims:', pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{claims_email}}\",\n    \"roles\": [\"ADMIN\"],\n    \"permissions\": [\"READ\", \"CREATE\", \"UPDATE\", \"DELETE\", \"SHARE\", \"ROTATE\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/setup/firebase/claims",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"setup",
								"firebase",
								"claims"
							]
						},
						"description": "Assign Firebase custom claims (roles + permissions) to a user so the backend can authorize their requests."
					},
					"response": []
				}
			],
			"description": "Setup endpoints for initial configuration"
		},
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Login with Google ID Token",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Check if Google ID token is set",
									"if (!pm.environment.get('google_id_token') || pm.environment.get('google_id_token') === '') {",
									"    console.warn('‚ö†Ô∏è Warning: google_id_token not set. Please set it in environment variables.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has JWT token\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('accessToken');",
									"    pm.expect(response).to.have.property('refreshToken');",
									"    pm.expect(response).to.have.property('tokenType');",
									"    pm.expect(response).to.have.property('expiresIn');",
									"    pm.expect(response.tokenType).to.equal('Bearer');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"jwt_token\", response.accessToken);",
									"    pm.environment.set(\"refresh_token\", response.refreshToken);",
									"    console.log(\"‚úÖ JWT token saved to environment\");",
									"    console.log(\"‚úÖ Refresh token saved to environment\");",
									"    console.log(\"Token expires in:\", response.expiresIn, \"seconds\");",
									"} else {",
									"    console.error(\"‚ùå Login failed:\", pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"idToken\": \"{{google_id_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Authenticate with Google ID token and receive JWT token"
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Check if refresh token is set",
									"if (!pm.environment.get('refresh_token') || pm.environment.get('refresh_token') === '') {",
									"    console.warn('‚ö†Ô∏è Warning: refresh_token not set. Please login first to get a refresh token.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has new tokens\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('accessToken');",
									"    pm.expect(response).to.have.property('refreshToken');",
									"    pm.expect(response).to.have.property('tokenType');",
									"    pm.expect(response).to.have.property('expiresIn');",
									"    pm.expect(response.tokenType).to.equal('Bearer');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"jwt_token\", response.accessToken);",
									"    pm.environment.set(\"refresh_token\", response.refreshToken);",
									"    console.log(\"‚úÖ New access token saved\");",
									"    console.log(\"‚úÖ New refresh token saved (token rotated)\");",
									"} else {",
									"    console.error(\"‚ùå Token refresh failed:\", pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refreshToken\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/refresh",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"refresh"
							]
						},
						"description": "Refresh access token using refresh token. Returns new access token and new refresh token (token rotation)."
					},
					"response": []
				},
				{
					"name": "Login - Invalid Token (Error Test)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 401\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test(\"Error message present\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('error');",
									"});",
									"",
									"console.log(\"‚úÖ Error handling works correctly\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"idToken\": \"invalid_token_12345\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Test error handling with invalid token"
					},
					"response": []
				}
			],
			"description": "Authentication endpoints"
		},
		{
			"name": "Admin",
			"item": [
				{
					"name": "Create User",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Check if JWT token is set",
									"if (!pm.environment.get('jwt_token') || pm.environment.get('jwt_token') === '') {",
									"    console.warn('‚ö†Ô∏è Warning: jwt_token not set. Please login first.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User created successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('uid');",
									"    pm.expect(response).to.have.property('email');",
									"    pm.expect(response).to.have.property('roles');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"new_user_uid\", response.uid);",
									"    pm.environment.set(\"new_user_email\", response.email);",
									"    console.log(\"‚úÖ User created:\", response.email);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"newuser@example.com\",\n    \"password\": \"Password123!@#\",\n    \"roles\": [\"USER\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"users"
							]
						},
						"description": "Create a new user (requires ADMIN role)"
					},
					"response": []
				},
				{
					"name": "Set User Roles",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Roles set successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('roles');",
									"    pm.expect(response.roles).to.be.an('array');",
									"});",
									"",
									"console.log(\"‚úÖ Roles updated. User must re-authenticate for changes to take effect.\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [\"USER\", \"ADMIN\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/users/{{user_uid}}/roles",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"users",
								"{{user_uid}}",
								"roles"
							]
						},
						"description": "Set roles (custom claims) for a user. User must re-authenticate for changes to take effect."
					},
					"response": []
				},
				{
					"name": "Get User by Email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User info retrieved\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('uid');",
									"    pm.expect(response).to.have.property('email');",
									"});",
									"",
									"console.log(\"‚úÖ User info retrieved successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/admin/users/{{user_email}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"users",
								"{{user_email}}"
							]
						},
						"description": "Get user information by email (requires ADMIN role)"
					},
					"response": []
				},
				{
					"name": "Set User Permissions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Permissions set successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('permissions');",
									"    pm.expect(response.permissions).to.be.an('array');",
									"});",
									"",
									"console.log(\"‚úÖ Permissions updated. User must re-authenticate for changes to take effect.\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"permissions\": [\"read\", \"write\", \"delete\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/users/{{user_uid}}/permissions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"users",
								"{{user_uid}}",
								"permissions"
							]
						},
						"description": "Set permissions (custom claims) for a user. Valid permissions: read, write, delete, share, rotate. User must re-authenticate for changes to take effect."
					},
					"response": []
				}
			],
			"description": "Admin endpoints for user management (requires ADMIN role)"
		},
		{
			"name": "Secrets",
			"item": [
				{
					"name": "Create Secret",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Generate unique key for testing",
									"const timestamp = Date.now();",
									"pm.environment.set('test_secret_key', 'test_secret_' + timestamp);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Secret created successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('id');",
									"    pm.expect(response).to.have.property('key');",
									"    pm.expect(response).to.have.property('value');",
									"    pm.expect(response).to.have.property('createdAt');",
									"    pm.expect(response.value).to.equal('MySecurePassword123!@#');",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set(\"secret_key\", response.key);",
									"    pm.environment.set(\"secret_id\", response.id);",
									"    console.log(\"‚úÖ Secret created with key:\", response.key);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"key\": \"{{test_secret_key}}\",\n    \"value\": \"MySecurePassword123!@#\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/secrets",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets"
							]
						},
						"description": "Create a new secret"
					},
					"response": []
				},
				{
					"name": "Get Secret by Key",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Secret retrieved successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('key');",
									"    pm.expect(response).to.have.property('value');",
									"    pm.expect(response.value).to.equal('MySecurePassword123!@#');",
									"});",
									"",
									"console.log(\"‚úÖ Secret retrieved and decrypted successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}"
							]
						},
						"description": "Get a specific secret by key"
					},
					"response": []
				},
				{
					"name": "Update Secret",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Secret updated successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('value');",
									"    pm.expect(response.value).to.equal('UpdatedPassword456!@#');",
									"});",
									"",
									"console.log(\"‚úÖ Secret updated successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"value\": \"UpdatedPassword456!@#\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}"
							]
						},
						"description": "Update a secret's value"
					},
					"response": []
				},
				{
					"name": "Delete Secret",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204\", function () {",
									"    pm.response.to.have.status(204);",
									"});",
									"",
									"console.log(\"‚úÖ Secret deleted successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}"
							]
						},
						"description": "Delete a secret"
					},
					"response": []
				},
				{
					"name": "Get Secret - Not Found (Error Test)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 404\", function () {",
									"    pm.response.to.have.status(404);",
									"});",
									"",
									"console.log(\"‚úÖ Error handling works correctly\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/nonexistent_secret_key_12345",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"nonexistent_secret_key_12345"
							]
						},
						"description": "Test error handling for non-existent secret"
					},
					"response": []
				},
				{
					"name": "Get Secret Versions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Versions retrieved successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.be.an('array');",
									"    if (response.length > 0) {",
									"        pm.expect(response[0]).to.have.property('versionNumber');",
									"        pm.expect(response[0]).to.have.property('secretKey');",
									"    }",
									"});",
									"",
									"console.log(\"‚úÖ Secret versions retrieved successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}/versions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}",
								"versions"
							]
						},
						"description": "Get all versions of a secret"
					},
					"response": []
				},
				{
					"name": "Get Specific Secret Version",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Version retrieved successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('versionNumber');",
									"    pm.expect(response).to.have.property('secretKey');",
									"});",
									"",
									"console.log(\"‚úÖ Secret version retrieved successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}/versions/1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}",
								"versions",
								"1"
							]
						},
						"description": "Get a specific version of a secret"
					},
					"response": []
				},
				{
					"name": "Rollback Secret to Version",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Secret rolled back successfully\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('key');",
									"    pm.expect(response).to.have.property('value');",
									"});",
									"",
									"console.log(\"‚úÖ Secret rolled back successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/secrets/{{secret_key}}/rollback/1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"secrets",
								"{{secret_key}}",
								"rollback",
								"1"
							]
						},
						"description": "Rollback a secret to a specific version"
					},
					"response": []
				}
			],
			"description": "Secret management endpoints"
		},
		{
			"name": "Audit Logs",
			"item": [
				{
					"name": "Get Audit Logs (Proxy)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get('jwt_token')) {",
									"    console.warn('‚ö†Ô∏è jwt_token not set. Please authenticate first.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response includes paged content\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('content');",
									"    pm.expect(response).to.have.property('totalElements');",
									"    pm.expect(response).to.have.property('pageSize');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    console.log(`‚úÖ Fetched ${response.content.length} audit records`);",
									"} else {",
									"    console.error('‚ùå Audit log fetch failed:', pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/audit?page=0&size=50&username={{audit_username}}&action={{audit_action}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "50"
								},
								{
									"key": "username",
									"value": "{{audit_username}}"
								},
								{
									"key": "action",
									"value": "{{audit_action}}"
								}
							]
						},
						"description": "Fetch audit logs via the secret-service proxy (requires ADMIN or MANAGER role)."
					},
					"response": []
				}
			],
			"description": "Audit log proxy endpoints (ADMIN or MANAGER role required)"
		},
		{
			"name": "Health",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Health status is UP\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('status');",
									"    pm.expect(response.status).to.equal('UP');",
									"});",
									"",
									"console.log(\"‚úÖ Application is healthy\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"actuator",
								"health"
							]
						},
						"description": "Check application health"
					},
					"response": []
				},
				{
					"name": "Info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"console.log(\"‚úÖ Application info retrieved\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/info",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"actuator",
								"info"
							]
						},
						"description": "Get application info"
					},
					"response": []
				}
			],
			"description": "Health and info endpoints"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global pre-request script",
					"console.log('üöÄ Starting request to:', pm.request.url.toString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script",
					"pm.test('Response time is less than 5000ms', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "google_id_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "admin_uid",
			"value": "",
			"type": "string"
		},
		{
			"key": "admin_email",
			"value": "admin@example.com",
			"type": "string"
		},
		{
			"key": "user_uid",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_email",
			"value": "user@example.com",
			"type": "string"
		},
		{
			"key": "secret_key",
			"value": "",
			"type": "string"
		},
		{
			"key": "secret_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "test_secret_key",
			"value": "",
			"type": "string"
		}
	]
}
